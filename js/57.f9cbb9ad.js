"use strict";(self["webpackChunkimooc_admin"]=self["webpackChunkimooc_admin"]||[]).push([[57],{730:function(e,l,a){a.d(l,{Uy:function(){return u},b6:function(){return o},hg:function(){return n}});var t=a(4471);const u=()=>(0,t.Z)({url:"/role/list"}),o=e=>(0,t.Z)({url:`/role/permission/${e}`}),n=e=>(0,t.Z)({url:"/role/distribute-permission",method:"POST",data:e})},8668:function(e,l,a){a.d(l,{IT:function(){return s},Z8:function(){return i},bo:function(){return u},cQ:function(){return o},h8:function(){return n},n3:function(){return r},ul:function(){return m}});var t=a(4471);const u=e=>(0,t.Z)({url:"/user-manage/list",params:e}),o=e=>(0,t.Z)({url:"/user-manage/batch/import",method:"POST",data:e}),n=e=>(0,t.Z)({url:`/user-manage/detele/${e}`}),i=()=>(0,t.Z)({url:"/user-manage/all-list"}),r=e=>(0,t.Z)({url:`/user-manage/detail/${e}`}),s=e=>(0,t.Z)({url:`/user-manage/role/${e}`}),m=(e,l)=>(0,t.Z)({url:`/user-manage/update-role/${e}`,method:"POST",data:{roles:l}})},3057:function(e,l,a){a.r(l),a.d(l,{default:function(){return C}});var t=a(6252),u=a(3577),o=a(2262),n=a(8668),i=a(3188),r=a(2119),s=a(9418),m=a(610),c=a(9150);const d={"姓名":"username","联系方式":"mobile","角色":"role","开通时间":"openTime"};var p=a(886);const g={class:"dialog-footer"};var w={props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(e,{emit:l}){const r=(0,c.QT)();let s=r.t("msg.excel.defaultName");const m=(0,o.iH)("");m.value=s,(0,i.K)((()=>{s=r.t("msg.excel.defaultName"),m.value=s}));const w=(0,o.iH)(!1),v=async()=>{w.value=!0;const e=(await(0,n.Z8)()).list,l=await Promise.all([a.e(869),a.e(62)]).then(a.bind(a,62)),t=f(d,e);l.export_json_to_excel({header:Object.keys(d),data:t,filename:m.value||s,autoWidth:!0,bookType:"xlsx"}),b()},f=(e,l)=>l.map((l=>Object.keys(e).map((a=>{if("role"===e[a]){const t=l[e[a]];return JSON.stringify(t.map((e=>e.title)))}return"openTime"===e[a]?(0,p.e)(l[e[a]]):l[e[a]]})))),b=()=>{l("update:modelValue",!1)};return(l,a)=>{const o=(0,t.up)("el-input"),n=(0,t.up)("el-button"),i=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(i,{title:l.$t("msg.excel.title"),"model-value":e.modelValue,onClose:b,width:"30%"},{footer:(0,t.w5)((()=>[(0,t._)("span",g,[(0,t.Wm)(n,{onClick:b},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(l.$t("msg.excel.close")),1)])),_:1}),(0,t.Wm)(n,{type:"primary",onClick:v,loading:w.value},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(l.$t("msg.excel.confirm")),1)])),_:1},8,["loading"])])])),default:(0,t.w5)((()=>[(0,t.Wm)(o,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),placeholder:l.$t("msg.excel.placeholder")},null,8,["modelValue","placeholder"])])),_:1},8,["title","model-value"])}}};const v=w;var f=v,b=a(730);const k={class:"dialog-footer"};var y={props:{modelValue:{type:Boolean,required:!0},userId:{type:String,required:!0}},emits:["update:modelValue","updateRole"],setup(e,{emit:l}){const a=e,r=(0,c.QT)(),s=async()=>{const e=w.value.map((e=>p.value.find((l=>l.title===e))));await(0,n.ul)(a.userId,e),m.z8.success(r.t("msg.role.updateRoleSuccess")),l("updateRole"),d()},d=()=>{l("update:modelValue",!1)},p=(0,o.iH)([]),g=async()=>{p.value=await(0,b.Uy)()};g(),(0,i.K)(g);const w=(0,o.iH)([]),v=async()=>{const e=await(0,n.IT)(a.userId);w.value=e.role.map((e=>e.title))};return(0,t.YP)((()=>a.userId),(e=>{e&&v()})),(l,a)=>{const o=(0,t.up)("el-checkbox"),n=(0,t.up)("el-checkbox-group"),i=(0,t.up)("el-button"),r=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(r,{title:l.$t("msg.excel.roleDialogTitle"),"model-value":e.modelValue,onClose:d},{footer:(0,t.w5)((()=>[(0,t._)("span",k,[(0,t.Wm)(i,{onClick:d},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(l.$t("msg.universal.cancel")),1)])),_:1}),(0,t.Wm)(i,{type:"primary",onClick:s},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(l.$t("msg.universal.confirm")),1)])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(n,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e)},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(p.value,(e=>((0,t.wg)(),(0,t.j4)(o,{key:e.id,label:e.title},null,8,["label"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["title","model-value"])}}};const x=y;var _=x;const h={class:"user-manage-container"},$={key:0},z={key:1};var W={setup(e){const l=(0,o.iH)([]),a=(0,o.iH)(0),d=(0,o.iH)(1),p=(0,o.iH)(2),g=async()=>{const e=await(0,n.bo)({page:d.value,size:p.value});l.value=e.list,a.value=e.total};g(),(0,i.K)(g),(0,t.dl)(g);const w=e=>{p.value=e,g()},v=e=>{d.value=e,g()},b=(0,o.iH)(!1),k=()=>{b.value=!0},y=(0,r.tv)(),x=e=>{y.push(`/user/info/${e}`)},W=(0,o.iH)(!1),U=(0,o.iH)(""),V=e=>{W.value=!0,U.value=e._id};(0,t.YP)(W,(e=>{e||(U.value="")}));const C=(0,c.QT)(),T=e=>{s.T.confirm(C.t("msg.excel.dialogTitle1")+e.username+C.t("msg.excel.dialogTitle2"),{type:"warning"}).then((async()=>{await(0,n.h8)(e._id),m.z8.success(C.t("msg.excel.removeSuccess")),await g()}))},H=()=>{y.push("/user/import")};return(e,n)=>{const i=(0,t.up)("el-button"),r=(0,t.up)("el-card"),s=(0,t.up)("el-table-column"),m=(0,t.up)("el-image"),c=(0,t.up)("el-tag"),y=(0,t.up)("el-table"),C=(0,t.up)("el-pagination"),Z=(0,t.Q2)("permission");return(0,t.wg)(),(0,t.iD)("div",h,[(0,t.Wm)(r,{class:"header"},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.wy)(((0,t.wg)(),(0,t.j4)(i,{type:"primary",onClick:H},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("msg.excel.importExcel")),1)])),_:1})),[[Z,["importUser"]]]),(0,t.Wm)(i,{type:"success",onClick:k},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("msg.excel.exportExcel")),1)])),_:1})])])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)(y,{data:l.value,border:"",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{label:"#",type:"index"}),(0,t.Wm)(s,{prop:"username",label:e.$t("msg.excel.name")},null,8,["label"]),(0,t.Wm)(s,{prop:"mobile",label:e.$t("msg.excel.mobile")},null,8,["label"]),(0,t.Wm)(s,{label:e.$t("msg.excel.avatar"),align:"center"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(m,{class:"avatar",src:e.avatar,"preview-src-list":[e.avatar]},null,8,["src","preview-src-list"])])),_:1},8,["label"]),(0,t.Wm)(s,{label:e.$t("msg.excel.role")},{default:(0,t.w5)((({row:l})=>[l.role&&l.role.length>0?((0,t.wg)(),(0,t.iD)("div",$,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.role,(e=>((0,t.wg)(),(0,t.j4)(c,{key:e.id,size:"mini"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.title),1)])),_:2},1024)))),128))])):((0,t.wg)(),(0,t.iD)("div",z,[(0,t.Wm)(c,{size:"mini"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("msg.excel.defaultRole")),1)])),_:1})]))])),_:1},8,["label"]),(0,t.Wm)(s,{label:e.$t("msg.excel.openTime")},{default:(0,t.w5)((({row:l})=>[(0,t.Uk)((0,u.zw)(e.$filters.dateFilter(l.openTime)),1)])),_:1},8,["label"]),(0,t.Wm)(s,{label:e.$t("msg.excel.action"),fixed:"right",width:"260"},{default:(0,t.w5)((({row:l})=>[(0,t.Wm)(i,{type:"primary",size:"mini",onClick:e=>x(l._id)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("msg.excel.show")),1)])),_:2},1032,["onClick"]),(0,t.wy)(((0,t.wg)(),(0,t.j4)(i,{type:"info",size:"mini",onClick:e=>V(l)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("msg.excel.showRole")),1)])),_:2},1032,["onClick"])),[[Z,["distributeRole"]]]),(0,t.wy)(((0,t.wg)(),(0,t.j4)(i,{type:"danger",size:"mini",onClick:e=>T(l)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,u.zw)(e.$t("msg.excel.remove")),1)])),_:2},1032,["onClick"])),[[Z,["removeUser"]]])])),_:1},8,["label"])])),_:1},8,["data"]),(0,t.Wm)(C,{class:"pagination",onSizeChange:w,onCurrentChange:v,"current-page":d.value,"page-sizes":[2,5,10,20],"page-size":p.value,layout:"total, sizes, prev, pager, next, jumper",total:a.value},null,8,["current-page","page-size","total"])])),_:1}),(0,t.Wm)((0,o.SU)(f),{modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=e=>b.value=e)},null,8,["modelValue"]),(0,t.Wm)((0,o.SU)(_),{modelValue:W.value,"onUpdate:modelValue":n[1]||(n[1]=e=>W.value=e),userId:U.value,onUpdateRole:g},null,8,["modelValue","userId"])])}}},U=a(3744);const V=(0,U.Z)(W,[["__scopeId","data-v-4da27cad"]]);var C=V}}]);
//# sourceMappingURL=57.f9cbb9ad.js.map